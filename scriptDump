# Install the AzureAD module if you haven't already
# Install-Module -Name AzureAD

# Connect to Azure AD
Connect-AzureAD

# Get a list of all Enterprise Applications
$enterpriseApps = Get-AzureADApplication -Filter "tags/any(c:c eq 'WindowsAzureActiveDirectoryOnPremises' or c eq 'WindowsAzureActiveDirectoryIntegratedApp')"

# Filter applications with SAML configured
$samlApps = $enterpriseApps | Where-Object {
    $_.RequiredResourceAccess | Where-Object {
        $_.ResourceAppId -eq "00000002-0000-0ff1-ce00-000000000000" -and
        $_.ResourceAccess | Where-Object {
            $_.Type -eq "4c4e3f75-f06f-4c0b-9c94-8eb37500d12d" -and
            $_.Id -eq "7ab1d382-f21e-4cce-8a61-758e6303090b"
        }
    }
}

# Display the list of Enterprise Applications with SAML
$samlApps | Select-Object -Property DisplayName, AppId, ObjectID | Format-Table -AutoSize

# Disconnect from Azure AD
Disconnect-AzureAD
