# Define your Microsoft 365 credentials
$clientId = "Your_Client_ID"
$clientSecret = "Your_Client_Secret"
$tenantId = "Your_Tenant_ID"

# Define the API endpoint to retrieve the App Connectors
$apiEndpoint = "https://graph.microsoft.com/v1.0/me/applications"

# Authenticate and get an access token
$tokenUrl = "https://login.microsoftonline.com/$tenantId/oauth2/token"
$body = @{
    client_id     = $clientId
    scope         = "https://graph.microsoft.com/.default"
    client_secret = $clientSecret
    grant_type    = "client_credentials"
}
$tokenResponse = Invoke-RestMethod -Method Post -Uri $tokenUrl -ContentType "application/x-www-form-urlencoded" -Body $body

# Extract the access token
$accessToken = $tokenResponse.access_token

# Make a GET request to the Microsoft Graph API to list App Connectors
$headers = @{
    Authorization = "Bearer $accessToken"
}
$appConnectors = Invoke-RestMethod -Method Get -Uri $apiEndpoint -Headers $headers

# Display the list of App Connectors
$appConnectors.value | ForEach-Object {
    Write-Host "App Connector Name: $($_.displayName)"
    Write-Host "App Connector ID: $($_.id)"
    Write-Host "------------------------"
}
